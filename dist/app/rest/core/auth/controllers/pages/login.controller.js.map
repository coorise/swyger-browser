{"version":3,"file":"login.controller.js","sources":["../../../../../../../src/app/rest/core/auth/controllers/pages/login.controller.js"],"sourcesContent":["import {ErrorLoginValidation,LoginValidation} from \"../../validations/login.validation.js\";\r\nconst LoginController = async (args)=>{\r\n  const {req,controller}=args;\r\n  //req.io.auth.socket.privateClient=true\r\n  //controller.client.io=req.io\r\n  //console.log('path : ', req.path)\r\n  //console.log('query : ', req.query)\r\n  //console.log('param : ', req.param)\r\n  const router=req.$router\r\n  //router.go('/')\r\n  //router.back('path')\r\n  //router.mount('path',function)\r\n  //router.off('path')\r\n  //router.reload()\r\n  const client=controller.client\r\n\r\n  let meta={\r\n    title:\"Login | Agglomy !\",\r\n    meta: [\r\n      {\r\n        name: \"child value\",\r\n        content: \"child content value\"\r\n      },\r\n    ]\r\n    // name:\"Name\"\r\n  }\r\n\r\n  const views={\r\n    // that is a way to import your template\r\n    // the let is the name and right side is the path\r\n    //so on your parent template, use  eg: <index/>\r\n    index:'pages/login.html',\r\n  }\r\n\r\n  let data={\r\n    user: controller?.authModel,\r\n    error: ErrorLoginValidation,\r\n    clientError:'',\r\n    async loginUser(){\r\n      //e.preventDefault(); // Otherwise the form will be submitted\r\n      try {\r\n        let validation = LoginValidation(this.user,this.error)\r\n\r\n        if(validation === 'ok'){\r\n          if(ENV==='dev') console.log('All Fields are completed');\r\n          let mUser={email:this.user.email,password:this.user.password}\r\n          let response= await client?.auth?.auth().login(mUser).val()\r\n          if(response?.error){\r\n            let authError=response?.error?.auth\r\n            switch (authError?.code) {\r\n              case 600:\r\n                this.clientError= authError?.message || 'This User does not exit!'\r\n                break;\r\n              case 601:\r\n                this.clientError= authError?.message || 'Verify your Password!'\r\n                break;\r\n\r\n            }\r\n          }else if (response?.data?.data){\r\n            this.clientError= ''\r\n            //let result=response?.data\r\n            //result?.data //for user info\r\n            //result?.refreshToken //for refresh token\r\n            //result?.token //for  token\r\n            req.go()\r\n          } else if(!response?.data?.token){\r\n            this.clientError= 'We noticed you are already logged in from another device.For security reason, we have sent a verification code to: '+this.user?.email\r\n            req.go('/auth/verify-token-code?email='+this.user.email+'&message='+this.clientError)\r\n          }\r\n\r\n\r\n        }\r\n      }catch (e) {\r\n        if(ENV==='dev')\r\n          console.log(e);\r\n      }\r\n\r\n    },\r\n    refreshToken(){\r\n\r\n    }\r\n\r\n\r\n  }\r\n  await controller.render({data, meta,views})\r\n}\r\n\r\nexport default LoginController\r\n"],"names":["LoginController","args","__async","req","controller","client","meta","views","data","ErrorLoginValidation","LoginValidation","mUser","response","_a","authError","_b","_c","_d","_e","e"],"mappings":"+SACK,MAACA,EAAyBC,GAAOC,EAAA,wBACpC,KAAM,CAAC,IAAAC,EAAI,WAAAC,CAAU,EAAEH,EAMVE,EAAI,QAMjB,MAAME,EAAOD,EAAW,OAExB,IAAIE,EAAK,CACP,MAAM,oBACN,KAAM,CACJ,CACE,KAAM,cACN,QAAS,qBACV,CACF,CAEF,EAED,MAAMC,EAAM,CAIV,MAAM,kBACP,EAED,IAAIC,EAAK,CACP,KAAMJ,GAAA,YAAAA,EAAY,UAClB,MAAOK,EACP,YAAY,GACN,WAAW,QAAAP,EAAA,oCAEf,GAAI,CAGF,GAFiBQ,EAAgB,KAAK,KAAK,KAAK,KAAK,IAEnC,KAAK,CAClB,MAAM,OAAO,QAAQ,IAAI,0BAA0B,EACtD,IAAIC,EAAM,CAAC,MAAM,KAAK,KAAK,MAAM,SAAS,KAAK,KAAK,QAAQ,EACxDC,EAAU,MAAMC,EAAAR,GAAA,YAAAA,EAAQ,OAAR,YAAAQ,EAAc,OAAO,MAAMF,GAAO,MACtD,GAAGC,GAAA,MAAAA,EAAU,MAAM,CACjB,IAAIE,GAAUC,EAAAH,GAAA,YAAAA,EAAU,QAAV,YAAAG,EAAiB,KAC/B,OAAQD,GAAA,YAAAA,EAAW,KAAI,CACrB,IAAK,KACH,KAAK,aAAaA,GAAA,YAAAA,EAAW,UAAW,2BACxC,MACF,IAAK,KACH,KAAK,aAAaA,GAAA,YAAAA,EAAW,UAAW,wBACxC,KAEH,CACb,MAAoBE,EAAAJ,GAAA,YAAAA,EAAU,OAAV,MAAAI,EAAgB,MACxB,KAAK,YAAa,GAKlBb,EAAI,GAAI,IACCc,EAAAL,GAAA,YAAAA,EAAU,OAAV,MAAAK,EAAgB,QACzB,KAAK,YAAa,wHAAsHC,EAAA,KAAK,OAAL,YAAAA,EAAW,OACnJf,EAAI,GAAG,iCAAiC,KAAK,KAAK,MAAM,YAAY,KAAK,WAAW,EAIvF,CACF,OAAOgB,EAAP,CACI,MAAM,OACP,QAAQ,IAAIA,CAAC,CAChB,CAEF,IACD,cAAc,CAEb,CAGF,EACD,MAAMf,EAAW,OAAO,CAAC,KAAAI,EAAM,KAAAF,EAAK,MAAAC,CAAK,CAAC,CAC5C"}