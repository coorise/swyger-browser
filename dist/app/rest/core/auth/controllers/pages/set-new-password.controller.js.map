{"version":3,"file":"set-new-password.controller.js","sources":["../../../../../../../src/app/rest/core/auth/controllers/pages/set-new-password.controller.js"],"sourcesContent":["import {ErrorLoginValidation, LoginValidation} from \"../../validations/login.validation.js\";\r\nconst SetNewPasswordController = async (args)=>{\r\n  const {req,controller}=args;\r\n  //req.io.auth.socket.privateClient=true\r\n  //controller.client.io=req.io\r\n  //console.log('path : ', req.path)\r\n  //console.log('query : ', req.query)\r\n  //console.log('param : ', req.param)\r\n  const router=req.$router\r\n  //router.go('/')\r\n  //router.back('path')\r\n  //router.mount('path',function)\r\n  //router.off('path')\r\n  //router.reload()\r\n  const client=controller.client\r\n\r\n  let meta={\r\n    title:\"Auth Set New Password | Agglomy !\",\r\n    meta: [\r\n      {\r\n        name: \"child value\",\r\n        content: \"child content value\"\r\n      },\r\n    ]\r\n    // name:\"Name\"\r\n  }\r\n\r\n  const views={\r\n    // that is a way to import your template\r\n    // the let is the name and right side is the path\r\n    //so on your parent template, use  eg: <index/>\r\n    index:'pages/verify-code.html',\r\n  }\r\n\r\n  let data={\r\n    message:req.query?.message||'',\r\n    page:'',\r\n    user: {\r\n      email:req.query?.email,\r\n      password:''\r\n    },\r\n    error: ErrorLoginValidation,\r\n    clientError:'',\r\n    async verifyCode(){\r\n      //e.preventDefault(); // Otherwise the form will be submitted\r\n      try {\r\n        let validation = LoginValidation(this.user,this.error)\r\n\r\n        if(validation === 'ok'){\r\n          if(ENV==='dev') console.log('All Fields are completed');\r\n          let mUser={email:this.user.email,password:this.user.password}\r\n          let response= await client?.auth().verifyTokenCode(mUser).val()\r\n          if(response?.error){\r\n            let authError=response?.error?.auth\r\n            switch (authError?.code) {\r\n              case 600:\r\n                this.clientError= authError?.message || 'This User does not exit!'\r\n                break;\r\n              case 607:\r\n                this.clientError= authError?.message || 'Code is Not Still Verified!'\r\n                break;\r\n\r\n            }\r\n          }else if (response?.data?.data){\r\n            this.clientError= ''\r\n            //let result=response?.data\r\n            //result?.data //for user info\r\n            //result?.refreshToken //for refresh token\r\n            //result?.token //for  token\r\n            req.go()\r\n          } else if(!response?.data?.token){\r\n            this.clientError= 'We noticed you are already logged in from another device.For security reason, we have sent a verification code to: '+this.user?.email\r\n          }\r\n\r\n\r\n        }\r\n      }catch (e) {\r\n        if(ENV==='dev')\r\n          console.log(e);\r\n      }\r\n\r\n    },\r\n    refreshToken(){\r\n\r\n    }\r\n\r\n\r\n  }\r\n  await controller.render({data, meta,views})\r\n}\r\n\r\nexport default SetNewPasswordController\r\n"],"names":["SetNewPasswordController","args","__async","req","controller","client","meta","views","data","_a","_b","ErrorLoginValidation","LoginValidation","mUser","response","authError","_c","_d","e"],"mappings":"+SACK,MAACA,EAAkCC,GAAOC,EAAA,gCAC7C,KAAM,CAAC,IAAAC,EAAI,WAAAC,CAAU,EAAEH,EAMVE,EAAI,QAMjB,MAAME,EAAOD,EAAW,OAExB,IAAIE,EAAK,CACP,MAAM,oCACN,KAAM,CACJ,CACE,KAAM,cACN,QAAS,qBACV,CACF,CAEF,EAED,MAAMC,EAAM,CAIV,MAAM,wBACP,EAED,IAAIC,EAAK,CACP,UAAQC,EAAAN,EAAI,QAAJ,YAAAM,EAAW,UAAS,GAC5B,KAAK,GACL,KAAM,CACJ,OAAMC,EAAAP,EAAI,QAAJ,YAAAO,EAAW,MACjB,SAAS,EACV,EACD,MAAOC,EACP,YAAY,GACN,YAAY,QAAAT,EAAA,kCAEhB,GAAI,CAGF,GAFiBU,EAAgB,KAAK,KAAK,KAAK,KAAK,IAEnC,KAAK,CAClB,MAAM,OAAO,QAAQ,IAAI,0BAA0B,EACtD,IAAIC,EAAM,CAAC,MAAM,KAAK,KAAK,MAAM,SAAS,KAAK,KAAK,QAAQ,EACxDC,EAAU,MAAMT,GAAA,YAAAA,EAAQ,OAAO,gBAAgBQ,GAAO,MAC1D,GAAGC,GAAA,MAAAA,EAAU,MAAM,CACjB,IAAIC,GAAUN,EAAAK,GAAA,YAAAA,EAAU,QAAV,YAAAL,EAAiB,KAC/B,OAAQM,GAAA,YAAAA,EAAW,KAAI,CACrB,IAAK,KACH,KAAK,aAAaA,GAAA,YAAAA,EAAW,UAAW,2BACxC,MACF,IAAK,KACH,KAAK,aAAaA,GAAA,YAAAA,EAAW,UAAW,8BACxC,KAEH,CACb,MAAoBL,EAAAI,GAAA,YAAAA,EAAU,OAAV,MAAAJ,EAAgB,MACxB,KAAK,YAAa,GAKlBP,EAAI,GAAI,IACCa,EAAAF,GAAA,YAAAA,EAAU,OAAV,MAAAE,EAAgB,QACzB,KAAK,YAAa,wHAAsHC,EAAA,KAAK,OAAL,YAAAA,EAAW,OAItJ,CACF,OAAOC,EAAP,CACI,MAAM,OACP,QAAQ,IAAIA,CAAC,CAChB,CAEF,IACD,cAAc,CAEb,CAGF,EACD,MAAMd,EAAW,OAAO,CAAC,KAAAI,EAAM,KAAAF,EAAK,MAAAC,CAAK,CAAC,CAC5C"}