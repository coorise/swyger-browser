{"version":3,"file":"verify-email-code.controller.js","sources":["../../../../../../../src/app/rest/core/auth/controllers/pages/verify-email-code.controller.js"],"sourcesContent":["import {ErrorCodeValidation,CodeValidation} from \"../../validations/code.validation.js\";\r\nconst VerifyEmailCodeController = async (args)=>{\r\n  const {req,controller}=args;\r\n  //req.io.auth.socket.privateClient=true\r\n  //controller.client.io=req.io\r\n  //console.log('path : ', req.path)\r\n  //console.log('query : ', req.query)\r\n  //console.log('param : ', req.param)\r\n  const router=req.$router\r\n  //router.go('/')\r\n  //router.back('path')\r\n  //router.mount('path',function)\r\n  //router.off('path')\r\n  //router.reload()\r\n  const client=controller.client\r\n\r\n  let meta={\r\n    title:\"Email Verify Code | Agglomy !\",\r\n    meta: [\r\n      {\r\n        name: \"child value\",\r\n        content: \"child content value\"\r\n      },\r\n    ]\r\n    // name:\"Name\"\r\n  }\r\n\r\n  const views={\r\n    // that is a way to import your template\r\n    // the let is the name and right side is the path\r\n    //so on your parent template, use  eg: <index/>\r\n    index:'pages/verify-code.html',\r\n  }\r\n\r\n  let data={\r\n    page:'verify-email',\r\n    message:req.query?.message||'',\r\n    user: {\r\n      email:req.query?.email,\r\n      code:''\r\n    },\r\n    error: ErrorCodeValidation,\r\n    clientError:'',\r\n    async verifyCode(){\r\n      //e.preventDefault(); // Otherwise the form will be submitted\r\n      try {\r\n        let validation = CodeValidation(this.user,this.error)\r\n\r\n        if(validation === 'ok'){\r\n          if(ENV==='dev') console.log('All Fields are completed');\r\n          let mUser={email:this.user.email,emailCode:this.user.code}\r\n          let response= await client?.auth().verifyEmailCode(mUser).val()\r\n          if(response?.error){\r\n            let authError=response?.error?.auth\r\n            switch (authError?.code) {\r\n              case 600:\r\n                this.clientError= authError?.message || 'This User does not exit!'\r\n                break;\r\n              case 605:\r\n                this.clientError= authError?.message || 'Code is Invalid!'\r\n                break;\r\n              case 606:\r\n                this.clientError= authError?.message || 'Code Is Expired!'\r\n                break;\r\n\r\n            }\r\n          }else if (response?.data?.data){\r\n            this.clientError= ''\r\n            //let result=response?.data\r\n            //result?.data //for user info\r\n            //result?.refreshToken //for refresh token\r\n            //result?.token //for  token\r\n            req.go()\r\n          }\r\n\r\n\r\n        }\r\n      }catch (e) {\r\n        if(ENV==='dev')\r\n          console.log(e);\r\n      }\r\n\r\n    },\r\n    refreshToken(){\r\n\r\n    }\r\n\r\n\r\n  }\r\n  await controller.render({data, meta,views})\r\n}\r\n\r\nexport default VerifyEmailCodeController\r\n"],"names":["VerifyEmailCodeController","args","__async","req","controller","client","meta","views","data","_a","_b","ErrorCodeValidation","CodeValidation","mUser","response","authError","e"],"mappings":"4SACK,MAACA,EAAmCC,GAAOC,EAAA,gCAC9C,KAAM,CAAC,IAAAC,EAAI,WAAAC,CAAU,EAAEH,EAMVE,EAAI,QAMjB,MAAME,EAAOD,EAAW,OAExB,IAAIE,EAAK,CACP,MAAM,gCACN,KAAM,CACJ,CACE,KAAM,cACN,QAAS,qBACV,CACF,CAEF,EAED,MAAMC,EAAM,CAIV,MAAM,wBACP,EAED,IAAIC,EAAK,CACP,KAAK,eACL,UAAQC,EAAAN,EAAI,QAAJ,YAAAM,EAAW,UAAS,GAC5B,KAAM,CACJ,OAAMC,EAAAP,EAAI,QAAJ,YAAAO,EAAW,MACjB,KAAK,EACN,EACD,MAAOC,EACP,YAAY,GACN,YAAY,QAAAT,EAAA,8BAEhB,GAAI,CAGF,GAFiBU,EAAe,KAAK,KAAK,KAAK,KAAK,IAElC,KAAK,CAClB,MAAM,OAAO,QAAQ,IAAI,0BAA0B,EACtD,IAAIC,EAAM,CAAC,MAAM,KAAK,KAAK,MAAM,UAAU,KAAK,KAAK,IAAI,EACrDC,EAAU,MAAMT,GAAA,YAAAA,EAAQ,OAAO,gBAAgBQ,GAAO,MAC1D,GAAGC,GAAA,MAAAA,EAAU,MAAM,CACjB,IAAIC,GAAUN,EAAAK,GAAA,YAAAA,EAAU,QAAV,YAAAL,EAAiB,KAC/B,OAAQM,GAAA,YAAAA,EAAW,KAAI,CACrB,IAAK,KACH,KAAK,aAAaA,GAAA,YAAAA,EAAW,UAAW,2BACxC,MACF,IAAK,KACH,KAAK,aAAaA,GAAA,YAAAA,EAAW,UAAW,mBACxC,MACF,IAAK,KACH,KAAK,aAAaA,GAAA,YAAAA,EAAW,UAAW,mBACxC,KAEH,CACb,MAAoBL,EAAAI,GAAA,YAAAA,EAAU,OAAV,MAAAJ,EAAgB,OACxB,KAAK,YAAa,GAKlBP,EAAI,GAAI,EAIX,CACF,OAAOa,EAAP,CACI,MAAM,OACP,QAAQ,IAAIA,CAAC,CAChB,CAEF,IACD,cAAc,CAEb,CAGF,EACD,MAAMZ,EAAW,OAAO,CAAC,KAAAI,EAAM,KAAAF,EAAK,MAAAC,CAAK,CAAC,CAC5C"}