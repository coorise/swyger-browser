{"version":3,"file":"base.controller.js","sources":["../../../../../src/app/helpers/common/controllers/base.controller.js"],"sourcesContent":["//Please do not change the createApp directory,\r\n//means that import {createApp,} from 'petite-vue', won't work during production\r\nimport {createApp,} from '../../../../resources/vendors/petite-vue'\r\nimport $ from 'jquery'\r\nimport MetaManager from 'head-manager'\r\n\r\nconst Component=(url)=>class CustomComponent extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  async connectedCallback() {\r\n    this.innerHTML = await (await fetch(url)).text()\r\n  }\r\n}\r\n\r\nexport default class BaseController{\r\n  accessToken=localStorage.getItem('accessToken')\r\n  date = new Date().getFullYear();\r\n  envDir=ENV==='dev'?'/src':''\r\n  env=ENV\r\n  theme='dashui' //default | you can put custom theme in: /static/public/themes\r\n  defaultThemePath\r\n  pathTheme='/index.html'\r\n  parentPath\r\n  defaultParentComponentPath\r\n  parentComponentPath\r\n  #metaManager //private variable\r\n  hooks={\r\n    //you can define customize hooks with controller\r\n    // good for your transition page, or when user is about to leave the page\r\n    index:{\r\n      beforeEnter: function () {\r\n      },\r\n      beforeLeave: function () {\r\n      },\r\n    }\r\n  }\r\n  components=[]\r\n\r\n  constructor() {\r\n\r\n    $.ajaxPrefilter(function( options, originalOptions, jqXHR ) {\r\n      options.async = true;\r\n    });\r\n    this.#metaManager=new MetaManager(\r\n      {\r\n        //\"base\": { href: \"./\" },\r\n        title:APP_GLOBAL_TITLE,\r\n        \"meta\": [\r\n          {\r\n            name: \"title\",\r\n            content: APP_GLOBAL_TITLE\r\n          },\r\n          {\r\n            name: \"description\",\r\n            content: APP_GLOBAL_TITLE\r\n          },\r\n        ]\r\n      }\r\n    )\r\n    this.#metaManager.render()\r\n  }\r\n  async render(args){\r\n    try {\r\n      let {data={},meta={},views={}}=args\r\n\r\n\r\n      if(this.components.length>0) this.components.forEach(component=>{\r\n        views={...views,...component?.views}\r\n        data={...data,...component?.data}\r\n      })\r\n\r\n      let iframe = $('#root_frame'),iframeContents,iframeElement;\r\n\r\n      if(localStorage.getItem('theme')){\r\n        this.theme = localStorage.getItem('theme')\r\n      }\r\n\r\n      this.defaultThemePath=this.pathTheme?_themes+'/'+this.theme+this.pathTheme:this.defaultThemePath\r\n      this.defaultParentComponentPath=this.parentComponentPath?_themes+'/'+this.theme+this.parentPath+this.parentComponentPath:this.defaultParentComponentPath\r\n\r\n      iframe.attr('src',this.defaultThemePath)\r\n      document.getElementById('root_frame').data = {\r\n        date:this.date,\r\n        envDir:this.envDir,\r\n        env:this.env,\r\n        visible:{\r\n          display:'block',\r\n        },\r\n        onCreated(){\r\n\r\n        },\r\n        onMounted(){\r\n\r\n        },\r\n        ...data,\r\n      }\r\n\r\n      let componentView=await (await fetch(_themes+'/'+this.theme+this.parentPath+this.parentComponentPath)).text()\r\n      for(let key of Object.keys(views)){\r\n        let childComponent=await (await fetch(_themes+'/'+this.theme+this.parentPath+views[key])).text()\r\n        componentView=componentView.replace(`<${key}/>`,childComponent)\r\n\r\n      }\r\n      let componentScript=await (await fetch(_root+'component.html')).text()\r\n      componentView=componentView+componentScript\r\n      /*iframe.on('load',async ()=>{\r\n        // window.onload is used when all external assets ( css,img , js) are successfully loaded\r\n        //we have some issue rendering with Mozilla Firefox browser, cuz it couldn't render the html with 'onload' compared to Chrome\r\n        //That's why we moved it outside the '.html(componentView)'\r\n        //We will fix it later if we see alternative of frame\r\n      })*/\r\n      iframeContents = iframe.contents();\r\n      iframeContents.find('#mainView').html(componentView)\r\n      /*document.getElementById('root_frame').contentWindow.postMessage(\r\n        JSON.stringify([\r\n          {\r\n            name:'index-m',\r\n            url:'./app/api/home/components/index.html'\r\n          }\r\n        ]),window.location.origin\r\n      )*/\r\n\r\n      //document.getElementById('root_frame').contentWindow.customElements.define('custom-component',Component('./app/api/home/components/index.html'));\r\n      iframeContents.find('body').addClass('scroll_theme_parent');\r\n      iframeElement =iframeContents.find('#metaView');\r\n      $('#root_meta').html(iframeElement.html());\r\n      /*iframeElement = iframeContents.find('#iconTheme');\r\n      message = iframeElement.prop('href').match(/\\/resources(.*)/g)[0];\r\n      console.log('icon url is: '+message);\r\n      $('#root_icon').attr('href',message);*/\r\n\r\n\r\n      await createApp(Object.assign(\r\n        {\r\n          env:this.env,\r\n          envDir:this.envDir,\r\n          onCreated(){\r\n          },\r\n          onMounted(){\r\n          }\r\n\r\n        },\r\n        //data // load your data for parent controller\r\n      )).mount('#root_html');\r\n      this.#metaManager.setTags(meta);\r\n      await this.#metaManager.render();\r\n    }catch (e) {\r\n      if(ENV==='dev')\r\n        console.log(e);\r\n    }\r\n\r\n\r\n  }\r\n\r\n}\r\n"],"names":["BaseController","__publicField","__privateAdd","_metaManager","$","options","originalOptions","jqXHR","__privateSet","MetaManager","__privateGet","args","__async","data","meta","views","component","__spreadValues","iframe","iframeContents","iframeElement","componentView","key","childComponent","componentScript","createApp","e"],"mappings":"43mBAgBe,MAAMA,EAAc,CAwBjC,aAAc,CAvBdC,EAAA,mBAAY,aAAa,QAAQ,aAAa,GAC9CA,EAAA,YAAO,IAAI,OAAO,eAClBA,EAAA,cAAO,MAAM,MAAM,OAAO,IAC1BA,EAAA,WAAI,KACJA,EAAA,aAAM,UACNA,EAAA,yBACAA,EAAA,iBAAU,eACVA,EAAA,mBACAA,EAAA,mCACAA,EAAA,4BACAC,EAAA,KAAAC,EAAA,QACAF,EAAA,aAAM,CAGJ,MAAM,CACJ,YAAa,UAAY,CACxB,EACD,YAAa,UAAY,CACxB,CACF,CACF,GACDA,EAAA,kBAAW,CAAE,GAIXG,EAAE,cAAc,SAAUC,EAASC,EAAiBC,EAAQ,CAC1DF,EAAQ,MAAQ,EACtB,CAAK,EACDG,EAAA,KAAKL,EAAa,IAAIM,EACpB,CAEE,MAAM,iBACN,KAAQ,CACN,CACE,KAAM,QACN,QAAS,gBACV,EACD,CACE,KAAM,cACN,QAAS,gBACV,CACF,CACF,CACF,GACDC,EAAA,KAAKP,GAAa,OAAQ,CAC3B,CACK,OAAOQ,EAAK,QAAAC,EAAA,sBAChB,GAAI,CACF,GAAI,CAAC,KAAAC,EAAK,GAAG,KAAAC,EAAK,CAAA,EAAG,MAAAC,EAAM,CAAE,CAAA,EAAEJ,EAG5B,KAAK,WAAW,OAAO,GAAG,KAAK,WAAW,QAAQK,GAAW,CAC9DD,EAAME,IAAA,GAAIF,GAASC,GAAA,YAAAA,EAAW,OAC9BH,EAAKI,IAAA,GAAIJ,GAAQG,GAAA,YAAAA,EAAW,KACpC,CAAO,EAED,IAAIE,EAASd,EAAE,aAAa,EAAEe,EAAeC,EAE1C,aAAa,QAAQ,OAAO,IAC7B,KAAK,MAAQ,aAAa,QAAQ,OAAO,GAG3C,KAAK,iBAAiB,KAAK,UAAU,QAAQ,IAAI,KAAK,MAAM,KAAK,UAAU,KAAK,iBAChF,KAAK,2BAA2B,KAAK,oBAAoB,QAAQ,IAAI,KAAK,MAAM,KAAK,WAAW,KAAK,oBAAoB,KAAK,2BAE9HF,EAAO,KAAK,MAAM,KAAK,gBAAgB,EACvC,SAAS,eAAe,YAAY,EAAE,KAAOD,EAAA,CAC3C,KAAK,KAAK,KACV,OAAO,KAAK,OACZ,IAAI,KAAK,IACT,QAAQ,CACN,QAAQ,OACT,EACD,WAAW,CAEV,EACD,WAAW,CAEV,GACEJ,GAGL,IAAIQ,EAAc,MAAO,MAAM,MAAM,QAAQ,IAAI,KAAK,MAAM,KAAK,WAAW,KAAK,mBAAmB,GAAG,KAAM,EAC7G,QAAQC,KAAO,OAAO,KAAKP,CAAK,EAAE,CAChC,IAAIQ,EAAe,MAAO,MAAM,MAAM,QAAQ,IAAI,KAAK,MAAM,KAAK,WAAWR,EAAMO,EAAI,GAAG,KAAM,EAChGD,EAAcA,EAAc,QAAQ,IAAIC,MAAQC,CAAc,CAE/D,CACD,IAAIC,EAAgB,MAAO,MAAM,MAAM,MAAM,gBAAgB,GAAG,KAAM,EACtEH,EAAcA,EAAcG,EAO5BL,EAAiBD,EAAO,WACxBC,EAAe,KAAK,WAAW,EAAE,KAAKE,CAAa,EAWnDF,EAAe,KAAK,MAAM,EAAE,SAAS,qBAAqB,EAC1DC,EAAeD,EAAe,KAAK,WAAW,EAC9Cf,EAAE,YAAY,EAAE,KAAKgB,EAAc,KAAM,CAAA,EAOzC,MAAMK,EAAU,OAAO,OACrB,CACE,IAAI,KAAK,IACT,OAAO,KAAK,OACZ,WAAW,CACV,EACD,WAAW,CACV,CAEF,CAET,CAAO,EAAE,MAAM,YAAY,EACrBf,EAAA,KAAKP,GAAa,QAAQW,CAAI,EAC9B,MAAMJ,EAAA,KAAKP,GAAa,QACzB,OAAOuB,EAAP,CACI,MAAM,OACP,QAAQ,IAAIA,CAAC,CAChB,CAGF,GAEH,CAjIEvB,EAAA"}