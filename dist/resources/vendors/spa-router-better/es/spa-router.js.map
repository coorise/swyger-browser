{"version":3,"file":"spa-router.js","sources":["../../../../../src/resources/vendors/spa-router-better/es/spa-router.js"],"sourcesContent":["var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nfunction extend() {\n  var obj = {};\n  var srcList = Array.prototype.slice.call(arguments, 0);\n  for (var i = 0, len = srcList.length; i < len; ++i) {\n    var src = srcList[i];\n    for (var q in src) {\n      if (src.hasOwnProperty(q)) {\n        obj[q] = src[q];\n      }\n    }\n  }\n  return obj;\n}\n\n// 判断是否 thenable 对象\nfunction isThenable(obj) {\n  return (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) === 'object' && typeof obj['then'] === 'function';\n}\n\n\n\nfunction addEvent(name, handler) {\n  if (window.addEventListener) {\n    window.addEventListener(name, handler, false);\n  } else if (window.attachEvent) {\n    window.attachEvent('on' + name, handler);\n  } else {\n    window['on' + name] = handler;\n  }\n}\n\nfunction warn(message) {\n  if (typeof console !== 'undefined') {\n    console.warn('[spa-router] ' + message);\n  }\n}\n\n\n\nvar isArray = Array.isArray ? Array.isArray : function (obj) {\n  return Object.prototype.toString.call(obj) === '[object Array]';\n};\n\nfunction makeSureArray(obj) {\n  return isArray(obj) ? obj : obj ? [obj] : [];\n}\n\nfunction ArrayCopy(arr) {\n  return arr.slice(0);\n}\n\nfunction formatHashBangURI(path) {\n  var raw = path.replace(/^#!?/, '');\n  // always\n  if (raw.charAt(0) !== '/') {\n    raw = '/' + raw;\n  }\n  return '/#!' + raw;\n}\n\nvar historySupport = function () {\n  var ua = window.navigator.userAgent;\n  if ((ua.indexOf('Android 2.') !== -1 || ua.indexOf('Android 4.0') !== -1) && ua.indexOf('Mobile Safari') !== -1 && ua.indexOf('Chrome') === -1 && ua.indexOf('Windows Phone') === -1) {\n    return false;\n  }\n  return window.history && 'pushState' in window.history;\n}();\n\nvar MODE = {\n  HASH: 1,\n  HASHBANG: 1,\n  HISTORY: 2\n};\n\nvar RouteMode = MODE.HASHBANG;\n\nvar _init = false;\n\n/// Listener\nvar Listener = {\n  listeners: [],\n\n  setUrlOnly: false,\n\n  supportHistory: function supportHistory() {\n    return historySupport;\n  },\n  setMode: function setMode(mode) {\n    mode = String(mode).toUpperCase();\n    RouteMode = MODE[mode] || MODE.HASHBANG;\n  },\n  init: function init() {\n    if (_init) {\n      return this;\n    }\n    _init = true;\n    if (RouteMode === MODE.HISTORY) {\n      // IE 10+\n      if (historySupport) {\n        addEvent('popstate', onchange);\n      } else {\n        RouteMode = MODE.HASHBANG;\n        // warning\n        warn('你的浏览器不支持 History API ，只能使用 hashbang 模式');\n        addEvent('hashchange', onchange);\n      }\n    } else {\n      addEvent('hashchange', onchange);\n    }\n    return this;\n  },\n  add: function add(fn) {\n    this.listeners.push(fn);\n    return this;\n  },\n  remove: function remove(id) {\n    for (var i = 0; i < this.listeners.length; ++i) {\n      if (this.listeners[i].id === id) {\n        this.listeners.splice(i, 1);\n        break;\n      }\n    }\n    return this;\n  },\n  setHashHistory: function setHashHistory(targetURL) {\n    if (RouteMode === MODE.HISTORY) {\n      history.pushState({}, '', targetURL);\n    } else {\n      if (targetURL[0] === '/') {\n        location.hash = '!' + targetURL;\n      } else {\n        var currentURL = location.hash.replace(/^#!?/, ''); // 去掉前面的 #!\n        var queryStringIndex = currentURL.indexOf('?');\n        if (queryStringIndex !== -1) {\n          currentURL = currentURL.slice(0, queryStringIndex);\n        }\n        if (/.*\\/$/.test(currentURL)) {\n          location.hash = '!' + currentURL + targetURL;\n        } else {\n          var hash = currentURL.replace(/([^\\/]+|)$/, function ($1) {\n            return $1 === '' ? '/' + targetURL : targetURL;\n          });\n          location.hash = '!' + hash;\n        }\n      }\n    }\n    return this;\n  },\n  stop: function stop() {\n    // remove event listener\n  }\n};\n\nfunction onchange(onChangeEvent) {\n  if (Listener.setUrlOnly) {\n    Listener.setUrlOnly = false;\n    return false;\n  }\n  var listeners = Listener.listeners;\n  for (var i = 0, l = listeners.length; i < l; i++) {\n    listeners[i].handler.call(null, onChangeEvent);\n  }\n}\n\nvar encode = encodeURIComponent;\nvar decode = decodeURIComponent;\n\nvar QS = {\n  /**\n   * querystring.stringify\n   * @param { Object } obj\n   * @param { Boolean } traditional [default:false]\n   * @return { String }\n   *\n   * traditional is true:  {x: [1, 2]} => 'x=1&x=2'\n   * traditional is false: {x: [1, 2]} => 'x[]=1&x[]=2'\n   */\n  stringify: function stringify(obj, traditional) {\n    if (!obj) {\n      return '';\n    }\n    var appendString = traditional ? '' : '[]';\n    var keysArray = [];\n    for (var p in obj) {\n      if (obj.hasOwnProperty(p)) {\n        keysArray.push(p);\n      }\n    }\n    var names = keysArray.sort();\n\n    var parts = [];\n    for (var i = 0; i < names.length; ++i) {\n      var name = names[i];\n      var value = obj[name];\n\n      if (isArray(value)) {\n        value.sort();\n        var _parts = [];\n        for (var j = 0; j < value.length; ++j) {\n          _parts.push('' + encode(name).replace(/%20/g, '+') + appendString + '=' + encode(value[j]).replace(/%20/g, '+'));\n        }\n        parts.push(_parts.join('&'));\n        continue;\n      }\n      parts.push(encode(name).replace(/%20/g, '+') + '=' + encode(value).replace(/%20/g, '+'));\n    }\n    return parts.join('&');\n  },\n\n\n  /**\n   * querystring.parse\n   * @param { String } queryString\n   * @return { Object }\n   *\n   * 'x=1&y=2' => {x: 1, y: 2}\n   * 'x=1&x=2' => {x: [1, 2]}\n   */\n  parse: function parse(queryString) {\n    if (typeof queryString !== 'string') {\n      return {};\n    }\n\n    queryString = queryString.trim().replace(/^(\\?|#)/, '');\n\n    if (queryString === '') {\n      return {};\n    }\n\n    var queryParts = queryString.split('&');\n\n    var query = {};\n\n    for (var i = 0; i < queryParts.length; ++i) {\n      var parts = queryParts[i].replace(/\\+/g, '%20').split('='); // 特殊字符`+`转换为空格\n      var name = decode(parts[0]),\n          value = parts[1] === undefined ? null : decode(parts[1]);\n\n      if (!query.hasOwnProperty(name)) {\n        query[name] = value;\n      } else if (isArray(query[name])) {\n        query[name].push(value);\n      } else {\n        query[name] = [query[name], value];\n      }\n    }\n    return query;\n  }\n};\n\nfunction RNode(value) {\n  this.path = value;\n  this.params = false;\n  this.title = false;\n  this.data = null;\n  this._hooks = {};\n  this.children = [];\n  this.parent = null;\n  this._registered = false;\n  this._forward = false;\n  this._redirect = null; // 重定向\n}\n\nvar proto$1 = RNode.prototype;\n\nfunction afterThen(thenable, restList, context, params) {\n  return thenable.then(function () {\n    return callThenableList(restList, context, params);\n  });\n}\n\nfunction callThenableList(callbacks, context, params) {\n  var currentReturn = void 0;\n  for (var i = 0; i < callbacks.length; ++i) {\n    currentReturn = callbacks[i].apply(context, params);\n    if (isThenable(currentReturn)) {\n      return afterThen(currentReturn, callbacks.slice(i + 1), context, params);\n    } else if (currentReturn === false) {\n      break;\n    }\n  }\n  return currentReturn;\n}\n\n// 如果返回 thenable 对象，则后面的回调要等到当前异步操作完成再执行，如果异步操作失败，则后面的回调不执行\n// 如果返回 false 则后面的回调不执行\nproto$1.callHooks = function _callHooks(hookName, Req) {\n  var callbacks = this._hooks[hookName] || [];\n  var _copyCallbacks = ArrayCopy(callbacks); // 复制一个，避免中间调用了 off 导致 length 变化\n  callThenableList(_copyCallbacks, null, [Req]);\n  return this;\n};\n\nproto$1.addHooks = function addHooks(hookName, callbacks) {\n  this._hooks[hookName] = makeSureArray(callbacks);\n  return this;\n};\n\n// add children\nproto$1.addChildren = function addChildren(children) {\n  if (isArray(children)) {\n    this.children = this.children.concat(children);\n  } else {\n    this.children.push(children);\n  }\n  return this;\n};\n\nproto$1.removeChild = function removeChild(child) {\n  for (var i = 0; i < this.children.length; ++i) {\n    if (this.children[i] === child) {\n      this.children.splice(i, 1);\n      break;\n    }\n  }\n  return this;\n};\n\nfunction createRNode(value) {\n  return new RNode(value);\n}\n\nfunction findNode(routeTreeRoot, routePath, createIfNotFound) {\n  if (routePath === '') {\n    // 当前节点\n    return routeTreeRoot;\n  }\n  var parts = routePath.split('/');\n  var target = null,\n      found = false;\n  var parent = routeTreeRoot;\n  var params = void 0;\n\n  var _loop = function _loop(i, len) {\n    params = false;\n    var realCurrentValue = parts[i];\n\n    var matcher = /:([a-zA-Z_][a-zA-Z0-9_]*)(\\([^\\)]+\\))?/g;\n\n    var k = 0;\n\n    function replacement($1, $2, $3) {\n      params = params || [];\n      params[k++] = $2;\n      if (!$3) {\n        // In IE 8 , $3 is an empty String while in other browser it is undefined.\n        return '([a-zA-Z0-9_]+)';\n      } else {\n        return $3;\n      }\n    }\n\n    realCurrentValue = realCurrentValue.replace(matcher, replacement);\n\n    for (var j = 0; j < parent.children.length; ++j) {\n      if (parent.children[j].path === realCurrentValue) {\n        target = parent.children[j];\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      // 不存在\n      if (!createIfNotFound) return {\n          v: false\n        };\n      // 创建新节点\n      var extendNode = createRNode(realCurrentValue);\n      parent.addChildren(extendNode);\n      extendNode.parent = parent;\n      extendNode.params = params;\n      target = extendNode;\n    }\n    parent = target;\n    found = false;\n  };\n\n  for (var i = 0, len = parts.length; i < len; ++i) {\n    var _ret = _loop(i, len);\n\n    if ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === \"object\") return _ret.v;\n  }\n  return target;\n}\n\nfunction createRouteNodeInPath(rootNode, routePath) {\n  routePath = routePath.replace(/^\\/([^\\/]*)/, '$1'); // 去掉前置 /\n  if (routePath === '*') {\n    var rnode = createRNode('');\n    rnode.parent = rootNode;\n    rootNode.addChildren(rnode);\n    return rnode;\n  } else {\n    return findNode(rootNode, routePath, true);\n  }\n}\n\n// 构造路由树\nfunction createRouteTree(namedRoutes, routeNode, routeOptions) {\n  if (routeOptions.name) {\n    if (namedRoutes[routeOptions.name]) {\n      warn('\\u5DF2\\u7ECF\\u5B58\\u5728\\u7684\\u5177\\u540D\\u8DEF\\u7531 ' + routeOptions.name + ' \\u5C06\\u88AB\\u8986\\u76D6');\n    }\n    namedRoutes[routeOptions.name] = routeNode;\n  }\n  if (routeOptions.data) {\n    routeNode.data = routeOptions.data;\n  }\n  if (routeOptions.title) {\n    routeNode.title = routeOptions.title;\n  }\n  if (routeOptions.redirect) {\n    routeNode._redirect = routeOptions.redirect;\n  }\n  if (routeOptions.forward) {\n    routeNode._forward = true;\n  }\n  routeNode.addHooks('beforeEnter', routeOptions.beforeEnter);\n  routeNode.addHooks('callbacks', routeOptions.controllers);\n  routeNode.addHooks('beforeLeave', routeOptions.beforeLeave);\n  if (routeOptions.sub) {\n    // 子路由\n    for (var subRoutePath in routeOptions.sub) {\n      if (routeOptions.sub.hasOwnProperty(subRoutePath)) {\n        var subRouteNode = createRouteNodeInPath(routeNode, subRoutePath);\n        subRouteNode._registered = true;\n        createRouteTree(namedRoutes, subRouteNode, routeOptions.sub[subRoutePath]);\n      }\n    }\n  }\n}\n\n// 创建根结点\nfunction createRootRouteTree(namedRoutes, routes) {\n  var rootRouteNode = createRNode('');\n  createRouteTree(namedRoutes, rootRouteNode, {\n    sub: routes\n  });\n  return rootRouteNode;\n}\n\n// 计算一个节点在一棵树的层次\nfunction calcRNodeDepth(currentRouteNode) {\n  var depth = 0;\n  var rnode = currentRouteNode;\n  while (rnode) {\n    depth++;\n    rnode = rnode.parent;\n  }\n  return depth;\n}\n\n/**\n * dfs 找匹配的路由节点\n * @param {RNode} currentRouteNode 当前节点\n * @param {Array} parts 路径分段数组\n * */\n// @TODO pages 很长并且打开 devtools 的时候会变慢？\nfunction dfs(currentRouteNode, parts) {\n  var currentPathValue = parts[0];\n  var matcher = new RegExp('^' + currentRouteNode.path + '$');\n  var matches = currentPathValue.match(matcher);\n  if (!matches) {\n    // 当前节点不匹配，返回\n    // 如果当前节点是 * 节点，则可能在找不到的时候返回这个节点\n    if (currentRouteNode.path === '') {\n      return {\n        rnode: currentRouteNode,\n        params: {},\n        notFound: true\n      };\n    }\n    return false;\n  }\n  var currentParams = {};\n  if (currentRouteNode.params) {\n    var paramsMatches = Array.prototype.slice.call(matches, 1);\n    for (var _k = 0; _k < paramsMatches.length; ++_k) {\n      currentParams[currentRouteNode.params[_k]] = paramsMatches[_k];\n    }\n  }\n  if (parts.length === 1) {\n    // 在当前节点完成匹配\n    if (!currentRouteNode._registered) {\n      // 不是注册节点\n      return false;\n    }\n    return {\n      rnode: currentRouteNode,\n      params: currentParams\n    };\n  }\n  var notFoundList = [];\n  for (var i = 0; i < currentRouteNode.children.length; ++i) {\n    var _result = dfs(currentRouteNode.children[i], parts.slice(1));\n    if (_result && !_result.notFound) {\n      // 在子树中完成匹配\n      // 合并 params\n      for (var p in _result.params) {\n        if (_result.params.hasOwnProperty(p)) {\n          currentParams[p] = _result.params[p];\n        }\n      }\n      return {\n        rnode: _result.rnode,\n        params: currentParams\n      };\n    }\n    if (_result.notFound) {\n      // 合并 currentParams\n      for (var _p in currentParams) {\n        if (currentParams.hasOwnProperty(_p)) {\n          _result.params[_p] = currentParams[_p];\n        }\n      }\n      notFoundList.push(_result);\n    }\n  }\n  // 全部路径都走完，找不到匹配项\n  // 如果有 * 节点匹配，则返回匹配路径最长的 * 节点\n  if (notFoundList.length > 0) {\n    var max = -1,\n        maxIndex = -1;\n    for (var _i = 0; _i < notFoundList.length; ++_i) {\n      var depth = calcRNodeDepth(notFoundList[_i].rnode);\n      if (depth > max) {\n        max = depth;\n        maxIndex = _i;\n      }\n    }\n    return notFoundList[maxIndex];\n  }\n  return false;\n}\n\n/**\n * 搜索路由树，看是否存在匹配的路径，如果存在，返回相应的回调函数\n * @todo 只返回第一个匹配到的路由（如果存在多个匹配？）\n * @param {RNode} tree 树根\n * @param {String} path 要匹配的路径\n * 返回值包含两个，用数组表示[rnode, params]\n * @return {Function|Array|null} 如果存在就返回相应的回调，否则返回null\n * @return {[Array, Object]} 同时返回回调和参数\n *\n * */\n\n\nfunction searchRouteTree2(tree, path) {\n  path = path === '/' ? '' : path; // 如果是 / 路径，特殊处理（避免 split 之后多一项）\n\n  var result = dfs(tree, path.split('/'));\n\n  if (result && result.rnode) {\n    var forwardList = []; // 找到匹配路径上的全部节点\n    var node = result.rnode;\n    while (node.parent) {\n      if (node.parent._registered && node.parent._forward) {\n        forwardList.unshift(node.parent);\n      }\n      node = node.parent;\n    }\n    result.forwardList = forwardList;\n  }\n\n  return result;\n}\n\nvar lastReq = null;\nvar lastRouteNode = null;\n\nfunction handlerHashbangMode(onChangeEvent) {\n  var newURL = onChangeEvent && onChangeEvent.newURL || location.hash;\n  var url = newURL.replace(/.*#!/, '');\n  this.dispatch(url.charAt(0) === '/' ? url : '/' + url);\n}\n\nfunction handlerHistoryMode(onChangeEvent) {\n  var url = location.pathname + location.search + location.hash;\n  this.dispatch(url.charAt(0) === '/' ? url : '/' + url);\n}\n\nfunction start() {\n  if (this._isRunning) {\n    // start 只调用一次\n    warn('start 方法只能调用一次');\n    return this;\n  }\n  this._isRunning = true;\n  var _handler = this.options.mode === 'history' ? handlerHistoryMode : handlerHashbangMode;\n  var _this = this;\n  Listener.init().add({\n    id: this._uid,\n    handler: function handler() {\n      return _handler.call(_this);\n    }\n  });\n  if (this.options.mode !== 'history' && !/^#!\\//.test(location.hash)) {\n    var i = location.href.indexOf('#');\n    var url = location.hash.replace(/^#!?/, '');\n    location.replace(location.href.slice(0, i >= 0 ? i : 0) + '#!/' + url.replace(/^\\//, ''));\n  } else {\n    // 首次触发\n    _handler.call(this);\n  }\n  return this;\n}\n\nfunction stop() {\n  Listener.remove(this._uid);\n  this._isRunning = false;\n  return this;\n}\n\nfunction destroy() {\n  this.stop();\n  this._namedRoutes = null;\n  this._rtree = null;\n  this._hooks = null;\n  this.options = null;\n  return null;\n}\n\n// 动态添加新路由（可能会替换原有的路由）\nfunction mount(routePath, routes) {\n  routePath = routePath.replace(/^\\/([^\\/]*)/, '$1'); // 去掉前置 /\n  var currentRouteNode = findNode(this._rtree, routePath, true);\n  createRouteTree(this._namedRoutes, currentRouteNode, routes);\n  return this;\n}\n\n// 路由描述对象转换为路径\n// 如果缺少参数，会抛出错误\nfunction routeDescObjToPath(namedRoutes, routeDescObj) {\n  var routeNode = namedRoutes[routeDescObj.name];\n  if (!routeNode) {\n    return null;\n  }\n  var paths = [];\n  var rnode = routeNode;\n  while (rnode) {\n    var pathvalue = rnode.path;\n    if (rnode.params) {\n      (function () {\n        if (!routeDescObj.params) {\n          throw new Error('缺少参数');\n        }\n        var paramsIndex = 0;\n        pathvalue = pathvalue.replace(/\\([^\\)]+\\)/g, function ($1) {\n          var paramKey = rnode.params[paramsIndex++];\n          if (!routeDescObj.params.hasOwnProperty(paramKey)) {\n            throw new Error('\\u7F3A\\u5C11\\u53C2\\u6570 \"' + paramKey + '\"');\n          }\n          return routeDescObj.params[paramKey];\n        });\n      })();\n    }\n    paths.unshift(pathvalue);\n    rnode = rnode.parent;\n  }\n  var query = '';\n  if (routeDescObj.query) {\n    query += '?' + QS.stringify(routeDescObj.query, routeDescObj.traditional);\n  }\n  return paths.join('/') + query;\n}\n\n// 根据给定的路径，遍历路由树，只要找到一个匹配的就把路由返回\nfunction dispatch(path) {\n  if ((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path !== null) {\n    // {name: 'routeName', params: {}}\n    path = routeDescObjToPath(this._namedRoutes, path);\n  }\n  if (lastReq) {\n    this._callHooks('beforeEachLeave', lastReq);\n    if (lastRouteNode) {\n      lastRouteNode.callHooks('beforeLeave', lastReq);\n    }\n  }\n  var routeTree = this._rtree;\n  // 保存原始请求uri\n  var uri = path;\n  var queryIndex = path.indexOf('?');\n  var _hashIndex = path.indexOf('#');\n  var hashIndex = _hashIndex === -1 ? path.length : _hashIndex;\n  var queryString = queryIndex === -1 ? '' : path.slice(queryIndex + 1, hashIndex);\n  path = queryIndex === -1 ? path : path.slice(0, queryIndex);\n  var Req = { uri: uri, path: path, query: QS.parse(queryString), $router: this };\n\n  if (path === '/') {\n    path = '';\n  }\n  var result = searchRouteTree2(routeTree, path);\n  if (!result) return this; // 啥都找不到\n  var routeNode = result.rnode,\n      params = result.params;\n  // 如果有 redirect 就重定向\n  if (routeNode._redirect) {\n    this.redirect(routeNode._redirect);\n    return this;\n  }\n  Req.params = params;\n  Req.data = routeNode ? routeNode.data : null;\n  // 更新 this.current\n  this.current = {\n    uri: Req.uri,\n    path: Req.path,\n    query: Req.query,\n    params: Req.params,\n    data: Req.data\n  };\n  if (routeNode) {\n    if (routeNode.title !== false) {\n      document.title = routeNode.title;\n    } else {\n      if (this.options.title !== false) {\n        document.title = this.options.title;\n      }\n    }\n  }\n  this._callHooks('beforeEachEnter', Req);\n  var forwardList = result.forwardList;\n  // 如果有 forward 先执行 forward\n  if (forwardList) {\n    for (var i = 0; i < forwardList.length; ++i) {\n      var forwardNode = forwardList[i];\n      forwardNode.callHooks('callbacks', Req);\n    }\n  }\n  if (routeNode) {\n    routeNode.callHooks('beforeEnter', Req); // @TODO 如果 beforeEnter 返回 false 或者 Promise 会影响 callbacks\n    routeNode.callHooks('callbacks', Req);\n  }\n  lastReq = Req;\n  lastRouteNode = routeNode;\n  return this;\n}\n\n// 动态添加路由回调\nfunction on(routePath, callbacks) {\n  routePath = routePath.replace(/^\\/([^\\/]*)/, '$1'); // 去掉前置 /\n  var routeNode = findNode(this._rtree, routePath, true);\n  if (!routeNode._hooks['callbacks']) {\n    routeNode.addHooks('callbacks', callbacks);\n  } else {\n    routeNode._hooks['callbacks'] = routeNode._hooks['callbacks'].concat(makeSureArray(callbacks));\n  }\n  return this;\n}\n\n// 动态移除路由回调\nfunction off(routePath, cb) {\n  routePath = routePath.replace(/^\\/([^\\/]*)/, '$1'); // 去掉前置 /\n  var routeNode = findNode(this._rtree, routePath, false);\n  if (routeNode && routeNode._hooks['callbacks']) {\n    if (cb) {\n      for (var i = 0; i < routeNode._hooks['callbacks'].length; ++i) {\n        if (routeNode._hooks['callbacks'][i] === cb) {\n          routeNode._hooks['callbacks'].splice(i, 1);\n          break;\n        }\n      }\n    } else {\n      routeNode._hooks['callbacks'].splice(0, routeNode._hooks['callbacks'].length);\n    }\n  }\n  if (routeNode && routeNode._hooks['callbacks'] && routeNode._hooks['callbacks'].length === 0 && routeNode.children.length === 0 && routeNode.parent) {\n    routeNode.parent.removeChild(routeNode);\n  }\n  return this;\n}\n\n// 动态添加路由回调，但是只响应一次\nfunction once(routePath, callbacks) {\n  callbacks = makeSureArray(callbacks);\n  var _this = this;\n  function onlyOnce(req) {\n    for (var i = 0; i < callbacks.length; ++i) {\n      callbacks[i].call(_this, req);\n    }\n    _this.off(routePath, onlyOnce);\n  }\n  return this.on(routePath, onlyOnce);\n}\n\n/**\n * 这个方法会改变当前页面的 `url`，从而触发路由\n * 在 history 模式下，用户无法通过标签改变 `url` 而不跳转页面，需要监听 click 事件，禁止默认跳转行为，并调用 go 方法\n * 如果是 history 模式，相当于调用一次 history.pushState() 然后再调用 .dispatch()\n * 如果 url 没有改变，不会\"刷新\"页面，要通过代码“刷新”页面，可以调用 reload 方法\n *\n * path 可以是一个路由描述对象\n * */\nfunction go(path) {\n  var loc = window.location;\n  var oldURI = loc.pathname + loc.search;\n  if ((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path !== null) {\n    path = routeDescObjToPath(this._namedRoutes, path);\n  }\n  Listener.setHashHistory(path);\n  var newURI = '' + loc.pathname + loc.search;\n  if (this.options.mode === 'history' && oldURI !== newURI) {\n    this.dispatch(newURI);\n  }\n  return this;\n}\n\nfunction back() {\n  if (Listener.supportHistory()) {\n    window['history'].back();\n  } else {}\n  return this;\n}\n\n// 只改变当前的 `url` 但是不触发路由\n// 和 dispatch 刚好相反，dispatch 只触发路由但不改变 `url`\nfunction setUrlOnly(path) {\n  if ((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path !== null) {\n    path = routeDescObjToPath(this._namedRoutes, path);\n  }\n  Listener.setUrlOnly = true; // make sure not to trigger anything\n  Listener.setHashHistory(path);\n  return this;\n}\n\n// 重载当前页面\nfunction reload() {\n  if (this.options.mode === 'history') {\n    this.dispatch('' + location.pathname + location.search + location.hash);\n  } else {\n    this.dispatch(location.hash.replace(/^#!?/, ''));\n  }\n  return this;\n}\n\n// 重定向（只产生一条历史记录）\nfunction redirect(path) {\n  if ((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path !== null) {\n    // {name: 'routeName', params: {}}\n    path = routeDescObjToPath(this._namedRoutes, path);\n  }\n  if (this.options.mode === 'history') {\n    history.replaceState({}, '', path);\n    this.dispatch(path);\n  } else {\n    location.replace(formatHashBangURI(path));\n  }\n  return this;\n}\n\n// 创建一个链接\nfunction createLink(linkTo) {\n  var result = routeDescObjToPath(this._namedRoutes, linkTo);\n  if (result === null) {\n    warn('\\u8DEF\\u5F84 ' + linkTo.name + ' \\u4E0D\\u5B58\\u5728');\n    result = '/';\n  }\n  result = result === '' ? '/' : result;\n  return this.options.mode === 'history' ? result : '/#!' + result;\n}\n\nvar uid = 0;\n\n// mode: history|hashbang\n// history     使用 HTML5 History API\n// hashbang    使用 hash（hashbang 模式）\nvar optionDefaults = {\n  title: false,\n  mode: 'hashbang'\n};\n\n/**\n * Router (routes)\n * @constructor\n * @param {Object} routes **Optional**\n */\n// 虽然允许在同一个应用创建多个 Router ，但是正常情况下你只需要创建一个实例\nfunction Router(routes, options) {\n  routes = routes || {};\n  this._namedRoutes = {}; // 具名路由\n  this._rtree = createRootRouteTree(this._namedRoutes, routes);\n  this._hooks = {}; // 全局钩子\n  this._init(options);\n  this.current = {}; // 记录当前的 path 等信息\n}\n\nRouter.QS = QS;\n\nvar proto = Router.prototype;\n\nproto._init = function _init(options) {\n  options = options || {};\n  this._uid = uid++;\n  this._isRunning = false;\n  this.options = extend({}, optionDefaults, options);\n  Listener.setMode(options.mode);\n  this._hooks['beforeEachEnter'] = makeSureArray(options.beforeEachEnter);\n  this._hooks['beforeEachLeave'] = makeSureArray(options.beforeEachLeave);\n};\n\n// 调用全局钩子\nproto._callHooks = function _callHooks(hookName, Req) {\n  var callbacks = this._hooks[hookName] || [];\n  for (var i = 0; i < callbacks.length; ++i) {\n    callbacks[i].call(this, Req);\n  }\n};\n\n// start a router\nproto.start = start; // 🆗\n\n// stop a router\nproto.stop = stop; // 🆗\n\n// destroy a router\nproto.destroy = destroy; // 🆗\n\n// mount a sub-route-tree on a route node\nproto.mount = mount; // 🆗\n\n// dynamic add a route to route-tree\nproto.on = on; // 🆗\n\n// like .on except that it will dispatch only once\nproto.once = once; // 🆗\n\n// stop listen to a route\nproto.off = off; // 🆗\n\n// dispatch a route if path matches\nproto.dispatch = dispatch; // 🆗\n\nproto.go = go; // 🆗\n\nproto.redirect = redirect; // 🆗\n\nproto.back = back;\n\n// only set url, don't dispatch any routes\nproto.setUrlOnly = setUrlOnly; // 🆗\n\n// redispatch current route\nproto.reload = reload; // 🆗\n\nproto.createLink = createLink;\n\nexport default Router;\n//# sourceMappingURL=spa-router.js.map\n"],"names":["_typeof","obj","extend","srcList","i","len","src","q","isThenable","addEvent","name","handler","warn","message","isArray","makeSureArray","ArrayCopy","arr","formatHashBangURI","path","raw","historySupport","ua","MODE","RouteMode","_init","Listener","mode","onchange","fn","id","targetURL","currentURL","queryStringIndex","hash","$1","onChangeEvent","listeners","l","encode","decode","QS","traditional","appendString","keysArray","p","names","parts","value","_parts","j","queryString","queryParts","query","RNode","proto$1","afterThen","thenable","restList","context","params","callThenableList","callbacks","currentReturn","hookName","Req","_copyCallbacks","children","child","createRNode","findNode","routeTreeRoot","routePath","createIfNotFound","target","found","parent","_loop","realCurrentValue","matcher","k","replacement","$2","$3","extendNode","_ret","createRouteNodeInPath","rootNode","rnode","createRouteTree","namedRoutes","routeNode","routeOptions","subRoutePath","subRouteNode","createRootRouteTree","routes","rootRouteNode","calcRNodeDepth","currentRouteNode","depth","dfs","currentPathValue","matches","currentParams","paramsMatches","_k","notFoundList","_result","_p","max","maxIndex","_i","searchRouteTree2","tree","result","forwardList","node","lastReq","lastRouteNode","handlerHashbangMode","newURL","url","handlerHistoryMode","start","_handler","_this","stop","destroy","mount","routeDescObjToPath","routeDescObj","paths","pathvalue","paramsIndex","paramKey","dispatch","routeTree","uri","queryIndex","_hashIndex","hashIndex","forwardNode","on","off","cb","once","onlyOnce","req","go","loc","oldURI","newURI","back","setUrlOnly","reload","redirect","createLink","linkTo","uid","optionDefaults","Router","options","proto"],"mappings":"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"}