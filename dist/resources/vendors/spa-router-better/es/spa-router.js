var k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};function W(){for(var r={},e=Array.prototype.slice.call(arguments,0),n=0,t=e.length;n<t;++n){var i=e[n];for(var a in i)i.hasOwnProperty(a)&&(r[a]=i[a])}return r}function J(r){return(typeof r=="undefined"?"undefined":k(r))==="object"&&typeof r.then=="function"}function T(r,e){window.addEventListener?window.addEventListener(r,e,!1):window.attachEvent?window.attachEvent("on"+r,e):window["on"+r]=e}function R(r){typeof console!="undefined"&&console.warn("[spa-router] "+r)}var C=Array.isArray?Array.isArray:function(r){return Object.prototype.toString.call(r)==="[object Array]"};function _(r){return C(r)?r:r?[r]:[]}function X(r){return r.slice(0)}function N(r){var e=r.replace(/^#!?/,"");return e.charAt(0)!=="/"&&(e="/"+e),"/#!"+e}var D=function(){var r=window.navigator.userAgent;return(r.indexOf("Android 2.")!==-1||r.indexOf("Android 4.0")!==-1)&&r.indexOf("Mobile Safari")!==-1&&r.indexOf("Chrome")===-1&&r.indexOf("Windows Phone")===-1?!1:window.history&&"pushState"in window.history}(),m={HASH:1,HASHBANG:1,HISTORY:2},A=m.HASHBANG,G=!1,v={listeners:[],setUrlOnly:!1,supportHistory:function(){return D},setMode:function(e){e=String(e).toUpperCase(),A=m[e]||m.HASHBANG},init:function(){return G?this:(G=!0,A===m.HISTORY?D?T("popstate",x):(A=m.HASHBANG,R("\u4F60\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 History API \uFF0C\u53EA\u80FD\u4F7F\u7528 hashbang \u6A21\u5F0F"),T("hashchange",x)):T("hashchange",x),this)},add:function(e){return this.listeners.push(e),this},remove:function(e){for(var n=0;n<this.listeners.length;++n)if(this.listeners[n].id===e){this.listeners.splice(n,1);break}return this},setHashHistory:function(e){if(A===m.HISTORY)history.pushState({},"",e);else if(e[0]==="/")location.hash="!"+e;else{var n=location.hash.replace(/^#!?/,""),t=n.indexOf("?");if(t!==-1&&(n=n.slice(0,t)),/.*\/$/.test(n))location.hash="!"+n+e;else{var i=n.replace(/([^\/]+|)$/,function(a){return a===""?"/"+e:e});location.hash="!"+i}}return this},stop:function(){}};function x(r){if(v.setUrlOnly)return v.setUrlOnly=!1,!1;for(var e=v.listeners,n=0,t=e.length;n<t;n++)e[n].handler.call(null,r)}var E=encodeURIComponent,U=decodeURIComponent,L={stringify:function(e,n){if(!e)return"";var t=n?"":"[]",i=[];for(var a in e)e.hasOwnProperty(a)&&i.push(a);for(var l=i.sort(),s=[],h=0;h<l.length;++h){var o=l[h],f=e[o];if(C(f)){f.sort();for(var u=[],d=0;d<f.length;++d)u.push(""+E(o).replace(/%20/g,"+")+t+"="+E(f[d]).replace(/%20/g,"+"));s.push(u.join("&"));continue}s.push(E(o).replace(/%20/g,"+")+"="+E(f).replace(/%20/g,"+"))}return s.join("&")},parse:function(e){if(typeof e!="string")return{};if(e=e.trim().replace(/^(\?|#)/,""),e==="")return{};for(var n=e.split("&"),t={},i=0;i<n.length;++i){var a=n[i].replace(/\+/g,"%20").split("="),l=U(a[0]),s=a[1]===void 0?null:U(a[1]);t.hasOwnProperty(l)?C(t[l])?t[l].push(s):t[l]=[t[l],s]:t[l]=s}return t}};function z(r){this.path=r,this.params=!1,this.title=!1,this.data=null,this._hooks={},this.children=[],this.parent=null,this._registered=!1,this._forward=!1,this._redirect=null}var I=z.prototype;function j(r,e,n,t){return r.then(function(){return Y(e,n,t)})}function Y(r,e,n){for(var t=void 0,i=0;i<r.length;++i){if(t=r[i].apply(e,n),J(t))return j(t,r.slice(i+1),e,n);if(t===!1)break}return t}I.callHooks=function(e,n){var t=this._hooks[e]||[],i=X(t);return Y(i,null,[n]),this};I.addHooks=function(e,n){return this._hooks[e]=_(n),this};I.addChildren=function(e){return C(e)?this.children=this.children.concat(e):this.children.push(e),this};I.removeChild=function(e){for(var n=0;n<this.children.length;++n)if(this.children[n]===e){this.children.splice(n,1);break}return this};function M(r){return new z(r)}function F(r,e,n){if(e==="")return r;for(var t=e.split("/"),i=null,a=!1,l=r,s=void 0,h=function(y,$){s=!1;var p=t[y],w=/:([a-zA-Z_][a-zA-Z0-9_]*)(\([^\)]+\))?/g,V=0;function K(Hr,P,q){return s=s||[],s[V++]=P,q||"([a-zA-Z0-9_]+)"}p=p.replace(w,K);for(var H=0;H<l.children.length;++H)if(l.children[H].path===p){i=l.children[H],a=!0;break}if(!a){if(!n)return{v:!1};var b=M(p);l.addChildren(b),b.parent=l,b.params=s,i=b}l=i,a=!1},o=0,f=t.length;o<f;++o){var u=h(o);if((typeof u=="undefined"?"undefined":k(u))==="object")return u.v}return i}function rr(r,e){if(e=e.replace(/^\/([^\/]*)/,"$1"),e==="*"){var n=M("");return n.parent=r,r.addChildren(n),n}else return F(r,e,!0)}function O(r,e,n){if(n.name&&(r[n.name]&&R("\u5DF2\u7ECF\u5B58\u5728\u7684\u5177\u540D\u8DEF\u7531 "+n.name+" \u5C06\u88AB\u8986\u76D6"),r[n.name]=e),n.data&&(e.data=n.data),n.title&&(e.title=n.title),n.redirect&&(e._redirect=n.redirect),n.forward&&(e._forward=!0),e.addHooks("beforeEnter",n.beforeEnter),e.addHooks("callbacks",n.controllers),e.addHooks("beforeLeave",n.beforeLeave),n.sub){for(var t in n.sub)if(n.sub.hasOwnProperty(t)){var i=rr(e,t);i._registered=!0,O(r,i,n.sub[t])}}}function er(r,e){var n=M("");return O(r,n,{sub:e}),n}function nr(r){for(var e=0,n=r;n;)e++,n=n.parent;return e}function Z(r,e){var n=e[0],t=new RegExp("^"+r.path+"$"),i=n.match(t);if(!i)return r.path===""?{rnode:r,params:{},notFound:!0}:!1;var a={};if(r.params)for(var l=Array.prototype.slice.call(i,1),s=0;s<l.length;++s)a[r.params[s]]=l[s];if(e.length===1)return r._registered?{rnode:r,params:a}:!1;for(var h=[],o=0;o<r.children.length;++o){var f=Z(r.children[o],e.slice(1));if(f&&!f.notFound){for(var u in f.params)f.params.hasOwnProperty(u)&&(a[u]=f.params[u]);return{rnode:f.rnode,params:a}}if(f.notFound){for(var d in a)a.hasOwnProperty(d)&&(f.params[d]=a[d]);h.push(f)}}if(h.length>0){for(var y=-1,$=-1,p=0;p<h.length;++p){var w=nr(h[p].rnode);w>y&&(y=w,$=p)}return h[$]}return!1}function tr(r,e){e=e==="/"?"":e;var n=Z(r,e.split("/"));if(n&&n.rnode){for(var t=[],i=n.rnode;i.parent;)i.parent._registered&&i.parent._forward&&t.unshift(i.parent),i=i.parent;n.forwardList=t}return n}var S=null,B=null;function ir(r){var e=r&&r.newURL||location.hash,n=e.replace(/.*#!/,"");this.dispatch(n.charAt(0)==="/"?n:"/"+n)}function ar(r){var e=location.pathname+location.search+location.hash;this.dispatch(e.charAt(0)==="/"?e:"/"+e)}function sr(){if(this._isRunning)return R("start \u65B9\u6CD5\u53EA\u80FD\u8C03\u7528\u4E00\u6B21"),this;this._isRunning=!0;var r=this.options.mode==="history"?ar:ir,e=this;if(v.init().add({id:this._uid,handler:function(){return r.call(e)}}),this.options.mode!=="history"&&!/^#!\//.test(location.hash)){var n=location.href.indexOf("#"),t=location.hash.replace(/^#!?/,"");location.replace(location.href.slice(0,n>=0?n:0)+"#!/"+t.replace(/^\//,""))}else r.call(this);return this}function or(){return v.remove(this._uid),this._isRunning=!1,this}function lr(){return this.stop(),this._namedRoutes=null,this._rtree=null,this._hooks=null,this.options=null,null}function fr(r,e){r=r.replace(/^\/([^\/]*)/,"$1");var n=F(this._rtree,r,!0);return O(this._namedRoutes,n,e),this}function g(r,e){var n=r[e.name];if(!n)return null;for(var t=[],i=n;i;){var a=i.path;i.params&&function(){if(!e.params)throw new Error("\u7F3A\u5C11\u53C2\u6570");var s=0;a=a.replace(/\([^\)]+\)/g,function(h){var o=i.params[s++];if(!e.params.hasOwnProperty(o))throw new Error('\u7F3A\u5C11\u53C2\u6570 "'+o+'"');return e.params[o]})}(),t.unshift(a),i=i.parent}var l="";return e.query&&(l+="?"+L.stringify(e.query,e.traditional)),t.join("/")+l}function hr(r){(typeof r=="undefined"?"undefined":k(r))==="object"&&r!==null&&(r=g(this._namedRoutes,r)),S&&(this._callHooks("beforeEachLeave",S),B&&B.callHooks("beforeLeave",S));var e=this._rtree,n=r,t=r.indexOf("?"),i=r.indexOf("#"),a=i===-1?r.length:i,l=t===-1?"":r.slice(t+1,a);r=t===-1?r:r.slice(0,t);var s={uri:n,path:r,query:L.parse(l),$router:this};r==="/"&&(r="");var h=tr(e,r);if(!h)return this;var o=h.rnode,f=h.params;if(o._redirect)return this.redirect(o._redirect),this;s.params=f,s.data=o?o.data:null,this.current={uri:s.uri,path:s.path,query:s.query,params:s.params,data:s.data},o&&(o.title!==!1?document.title=o.title:this.options.title!==!1&&(document.title=this.options.title)),this._callHooks("beforeEachEnter",s);var u=h.forwardList;if(u)for(var d=0;d<u.length;++d){var y=u[d];y.callHooks("callbacks",s)}return o&&(o.callHooks("beforeEnter",s),o.callHooks("callbacks",s)),S=s,B=o,this}function cr(r,e){r=r.replace(/^\/([^\/]*)/,"$1");var n=F(this._rtree,r,!0);return n._hooks.callbacks?n._hooks.callbacks=n._hooks.callbacks.concat(_(e)):n.addHooks("callbacks",e),this}function ur(r,e){r=r.replace(/^\/([^\/]*)/,"$1");var n=F(this._rtree,r,!1);if(n&&n._hooks.callbacks)if(e){for(var t=0;t<n._hooks.callbacks.length;++t)if(n._hooks.callbacks[t]===e){n._hooks.callbacks.splice(t,1);break}}else n._hooks.callbacks.splice(0,n._hooks.callbacks.length);return n&&n._hooks.callbacks&&n._hooks.callbacks.length===0&&n.children.length===0&&n.parent&&n.parent.removeChild(n),this}function dr(r,e){e=_(e);var n=this;function t(i){for(var a=0;a<e.length;++a)e[a].call(n,i);n.off(r,t)}return this.on(r,t)}function vr(r){var e=window.location,n=e.pathname+e.search;(typeof r=="undefined"?"undefined":k(r))==="object"&&r!==null&&(r=g(this._namedRoutes,r)),v.setHashHistory(r);var t=""+e.pathname+e.search;return this.options.mode==="history"&&n!==t&&this.dispatch(t),this}function pr(){return v.supportHistory()&&window.history.back(),this}function yr(r){return(typeof r=="undefined"?"undefined":k(r))==="object"&&r!==null&&(r=g(this._namedRoutes,r)),v.setUrlOnly=!0,v.setHashHistory(r),this}function mr(){return this.options.mode==="history"?this.dispatch(""+location.pathname+location.search+location.hash):this.dispatch(location.hash.replace(/^#!?/,"")),this}function kr(r){return(typeof r=="undefined"?"undefined":k(r))==="object"&&r!==null&&(r=g(this._namedRoutes,r)),this.options.mode==="history"?(history.replaceState({},"",r),this.dispatch(r)):location.replace(N(r)),this}function _r(r){var e=g(this._namedRoutes,r);return e===null&&(R("\u8DEF\u5F84 "+r.name+" \u4E0D\u5B58\u5728"),e="/"),e=e===""?"/":e,this.options.mode==="history"?e:"/#!"+e}var gr=0,wr={title:!1,mode:"hashbang"};function Q(r,e){r=r||{},this._namedRoutes={},this._rtree=er(this._namedRoutes,r),this._hooks={},this._init(e),this.current={}}Q.QS=L;var c=Q.prototype;c._init=function(e){e=e||{},this._uid=gr++,this._isRunning=!1,this.options=W({},wr,e),v.setMode(e.mode),this._hooks.beforeEachEnter=_(e.beforeEachEnter),this._hooks.beforeEachLeave=_(e.beforeEachLeave)};c._callHooks=function(e,n){for(var t=this._hooks[e]||[],i=0;i<t.length;++i)t[i].call(this,n)};c.start=sr;c.stop=or;c.destroy=lr;c.mount=fr;c.on=cr;c.once=dr;c.off=ur;c.dispatch=hr;c.go=vr;c.redirect=kr;c.back=pr;c.setUrlOnly=yr;c.reload=mr;c.createLink=_r;export{Q as default};
//# sourceMappingURL=spa-router.js.map
